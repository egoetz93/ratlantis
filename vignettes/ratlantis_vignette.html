<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="J. Stephen Gosnell" />

<meta name="date" content="2015-05-27" />

<title>Using ratlantis to develop, use, and compare Atlantis ecosytem models</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Using ratlantis to develop, use, and compare Atlantis ecosytem models</h1>
<h4 class="author"><em>J. Stephen Gosnell</em></h4>
<h4 class="date"><em>2015-05-27</em></h4>
</div>


<p>Ecoystem modeling is a growing areas of specialization. Multiple models (e.g., Ecopath w/ Ecosim and Ecospace, INVITRO) exist, each having their own set of strengths and weaknesses. However, a shared issue among these models is the the time, data, and software needed to complete them. These models, by their very nature, are data- and computationally-intensive, with development times often leading to model construction taking years to complete. To begin to address this issue, we have developed ratlantis.</p>
<p>The ratlantis package is designed to allow Atlantis ecosystem models to be developed rapidly (3-6 months is the goal, vs the 2 years projected in other documents). It does this by -providing access to software already designed by the Atlantis community via R, removing a learning curve and offering a single environment to design, execute, and analyze models -using existing R packages that can pull biological, geographic, and other types of data from public repositories to provide data needed for Atlantis models -offering a clear framework for developing a new model or modifying an existing one, where users supply data, modify output, and continue model development as needed</p>
<p>Atlantis, originally developed by Elizabeth Fulton at CSCIRO, is an ecosystem model designed to simulate long-term dynamics in marine systems. The model is spatially- and temporally-explicit, following the dynamics of numerous ecological groups in irregulary-shaped polygons of various depth. Groupings of organisms, polygon shapes, and depth levels are all determined by the user, and we leave the discussion of the implication of these decisions for other times. Here we will go through the basic use and development of an Atlantis model using the ratlantis package. While all steps could be completed in R, we will assume other pieces of software (table editors such as Excel or Sheets, GIS programs such as QGIS) are being used in the development workflow due to their common application. R users interested in fully developing models in this environment should be able to make small changes as needed.</p>
<p>This vignette and guide builds heavily on existing Atlantis documentation developed by Isaac Kaplan, Elizabeth Fulton, and Cameron Ainsworth <a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>. The CSIRO Atlantis wiki has also proved invaluable in model and package development.</p>
<div id="atlantis-steps-model-development" class="section level2">
<h2>Atlantis Steps: Model Development</h2>
<p>Atlantis model development consists of several key task: -map construction -group assignment -procuring and formatting environmental data -creating input for files for C++ Atlantis software</p>
<div id="map-development" class="section level3">
<h3>Map Development</h3>
<div id="short-version" class="section level4">
<h4>Short version</h4>
<p>Provide -a wgs84 formatted shape file with the area you wish to model carved into polygons. The only other attribute/data you need is for each polygon to be labelled (box_id); start at 0 and go as high as needed.<br />-Download bgmeriser.jar -Download a bathymetry file that includes your map area and make sure the depths are -negative -in a column named “Contour” -provide locations and names of shape files, depths you want to be used for Atlantis polygons, and location of bgmeriser software</p>
<p>Function should return a .bgm file to be used in Atlantis models.</p>
</div>
<div id="example" class="section level4">
<h4>Example</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rbgmeriser</span>( <span class="dt">map_location =</span> <span class="kw">paste</span>(<span class="st">&quot;C:/Dropbox/&quot;</span>, user, <span class="st">&quot;/Experiments/FSU Projects/Atlantis Model/Deep C Atlantis Model&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>),
            <span class="dt">map_name =</span> <span class="st">&quot;DeepCmap&quot;</span>,
            <span class="dt">boundary_boxes =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">52</span>),
            <span class="dt">get_bathymetry =</span> <span class="ot">TRUE</span>,
            <span class="dt">bathymetry_layer_location =</span> <span class="kw">paste</span>(<span class="st">&quot;C:/Dropbox/&quot;</span>, user, <span class="st">&quot;/Experiments/FSU Projects/Atlantis Model/Deep C Atlantis Model/New Shape files I downloaded/GCOOS/w98e78n31s18_isobath_selected_5-4000m&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>),
            <span class="dt">bathymetry_layer_name =</span> <span class="st">&quot;gom bath wgs84&quot;</span>,
            <span class="dt">bathymetry_cutoff =</span> .<span class="dv">9</span>,
            <span class="dt">bathymetry_levels =</span> <span class="kw">c</span>(-<span class="dv">10</span>, -<span class="dv">20</span>,-<span class="dv">50</span>, -<span class="dv">200</span>,-<span class="dv">1000</span>, -<span class="dv">2000</span>,-<span class="dv">4000</span>),
            <span class="dt">bgmeriser_location =</span><span class="st">&quot;C:/Users/SGosnell/Desktop/bgm&quot;</span>
)</code></pre>
</div>
<div id="longer-version-with-explanations" class="section level4">
<h4>Longer version with explanations</h4>
<p>Map development is handled via the rbgmeriser function, which assumes you have downloaded the java applet bgmeriser.jar. BGM (box geometry model) is the specific format used to delineate areas in Atlantis models.</p>
<p>To create a .bgm file (the final product), rbgmeriser requires wgs84 formatted shape file (created in QGIS, ArcGIS,etc) that shows the desired polygons. Polygons can be of any shape, but limiting sides and angles will help with computational time. Similarly, keeping polygons close to the same size is useful. Polygons can follow similar habitat areas, geographies, or areas of protection (reserves or fishing zones). Once developed in a mapping program, you must include a box_id column (going from 0 to the maximum number needed to number all boxes without skipping any numbers). You MAY also include a botz (set to the desired Atlantis depth for each polygon), horizmix, vertmix, and boundary column - all depths should be negative (below sea level) and boundary columns should be set to 1 unless a box is a adjacent to open water not included in the model (in which case it is set to 0).</p>
<p>If Depth is not set, you must provide the downloaded location of a bathymetry shape file that has a depth labeled as Contour (again, must be negative numbers), set get_bathymetry = T (default value), and list the desired depths for final model polygons (4-8 depths is recommended, for example in the Gulf of Mexico we set the max depth for each polygon to -10, -20,-50, -200,-1000, -2000,-4000 meters). The function overlays your polygon map on the bathymetry map to get depths for each site, and the bathymetry_cutoff functions instructs which quantile to take as the depth for each polygon (defaults to .9 to avoid a canyon overly influencing depths). The code then creates a botz column.</p>
<p>If boundary is not included, you must list the box_id values of the boundary boxes so a boundary column can be created.</p>
<p>If vertmix and horizmix are not defined, they are set to 0..00001 and 1, respectively, by default (standard for Atlantis models).</p>
</div>
</div>
</div>
<div id="atlantis-steps-model-calibration" class="section level2">
<h2>Atlantis Steps: Model Calibration</h2>
<p>Work in progress planned for completion fall 2015</p>
</div>
<div id="atlantis-steps-model-execution" class="section level2">
<h2>Atlantis Steps: Model Execution</h2>
<div id="short-version-1" class="section level4">
<h4>Short version</h4>
<p>Provide -This code assumes you have downloaded and compiled the C++ Atlantis code and requires –the location of the compliled Atlantis code –the name of the .exe file created by Atlanits code (e.g., atlantismain) –the names of files you have created to run Atlantis (which are stored in same folder at the .exe file) —biology_nc, the biology initial conditions file —run_file_prm, the initial conditions run file —forcing_time_series_prm, the file detailing initial forcings —physics_prm, the initial physics file detailing eddies and scaling —biology_prm, the biology parameter file —harvest_prm, the harvest file —functional_group_csv, the list of functional groups —fisheries_csv, the list delimiting targeted fisheries</p>
<p>The above are all created via code in ratlantis. You must also provide -output_file_nc, desired name for output file -output_folder, folder where should results be stored</p>
<p>Function will call the system shell and execute Atlantis</p>
</div>
<div id="example-1" class="section level4">
<h4>Example</h4>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">execute_atlantis</span>(<span class="dt">atlantis_location =</span> <span class="st">&quot;C:/exampleatlantis&quot;</span>, <span class="dt">atlantis_exe =</span> <span class="st">&quot;atlantismain&quot;</span>,
                              <span class="dt">biology_nc =</span><span class="st">&quot;init_VMPA_setas_25032013.nc&quot;</span>,
                              <span class="dt">output_file_nc =</span> <span class="st">&quot;outputSETAS.nc&quot;</span>, <span class="dt">run_file_prm =</span>
                                <span class="st">&quot;VMPA_setas_run_fishing_F_New.prm&quot;</span>,
                              <span class="dt">forcing_time_series_prm =</span> <span class="st">&quot;VMPA_setas_force_fish.prm&quot;</span>,
                              <span class="dt">physics_prm =</span> <span class="st">&quot;VMPA_setas_physics.prm&quot;</span>, biology_prm
                              =<span class="st"> &quot;VMPA_setas_biol_fishing_New.prm&quot;</span>,<span class="dt">harvest_prm =</span>
                                <span class="st">&quot;VMPA_setas_harvest_F_New.prm&quot;</span>,
                              <span class="dt">functional_group_csv =</span> <span class="st">&quot;SETasGroups.csv&quot;</span>,
                              <span class="dt">fisheries_csv =</span> <span class="st">&quot;SETasFisheries.csv&quot;</span>,
                              <span class="dt">output_folder =</span> <span class="st">&quot;Outputfoldertest&quot;</span>)</code></pre>
</div>
<div id="longer-version-with-explanations-1" class="section level4">
<h4>Longer version with explanations</h4>
<p>Atlantis is a C++ program. This code does not recreate Atlantis in R, it simply acts as a wrapper for the program.</p>
</div>
</div>
<div id="atlantis-steps-model-analysis" class="section level2">
<h2>Atlantis Steps: Model Analysis</h2>
<p>Work in progress planned for completion fall 2015</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>How to Build an Atlantis Model: A living document<a href="#fnref1">↩</a></p></li>
</ol>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
